[gd_scene load_steps=7 format=3 uid="uid://c6woybm3rk543"]

[ext_resource type="Script" uid="uid://q5r6b3b7clpj" path="res://cristal.gd" id="1_v6luj"]
[ext_resource type="Texture2D" uid="uid://ba2myg4gn6kjp" path="res://Sprites/cristal_vermelho.png" id="2_v6luj"]
[ext_resource type="Texture2D" uid="uid://bt5socl2sy4jw" path="res://UI_UX/efeito_distorcao.png" id="4_av7e6"]

[sub_resource type="Shader" id="Shader_nps87"]
code = "shader_type canvas_item;

// --- CONFIGURAÇÕES DO PULSO ---
uniform float pulse_speed = 3.0; // Quão rápido ele pulsa
uniform float falloff_min = 0.0; // O valor mínimo (brilho mais suave/espalhado)
uniform float falloff_max = 0.05; // O valor máximo (brilho mais focado/duro)

// Controla a força/opacidade geral do brilho
uniform float intensity = 8.0;

render_mode unshaded;

void fragment() {
	// Centraliza o UV
	vec2 centered_uv = UV - vec2(0.5);
	float distance_from_center = length(centered_uv);
	float base = min(distance_from_center * 2.0, 1.0);

	// --- LÓGICA DO PULSO (A MÁGICA ACONTECE AQUI) ---

	// 1. Criamos uma onda que vai de -1 a 1 baseada no tempo
	float sine_wave = sin(TIME * pulse_speed);

	// 2. Transformamos essa onda para ir de 0 a 1
	float normalized_wave = (sine_wave + 1.0) / 2.0;

	// 3. Usamos essa onda para oscilar o falloff entre o Mínimo e o Máximo
	float current_falloff = mix(falloff_min, falloff_max, normalized_wave);

	// --- FIM DA LÓGICA DO PULSO ---

	// Calcula a máscara usando o falloff animado
	float mask = 1.0 - pow(base, current_falloff);

	vec3 white_color = vec3(1.0, 1.0, 1.0);

	COLOR = vec4(white_color, mask * intensity);
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_e6wj2"]
shader = SubResource("Shader_nps87")
shader_parameter/pulse_speed = 3.0
shader_parameter/falloff_min = 0.0
shader_parameter/falloff_max = 0.05
shader_parameter/intensity = 8.0

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_ay01c"]
radius = 36.0
height = 92.0

[node name="cristal_vermelho" type="StaticBody2D"]
light_mask = 1023
script = ExtResource("1_v6luj")

[node name="efeito_cristal" type="Sprite2D" parent="."]
material = SubResource("ShaderMaterial_e6wj2")
position = Vector2(-22, 6)
scale = Vector2(1.12, 1.12)
texture = ExtResource("4_av7e6")

[node name="Sprite2D" type="Sprite2D" parent="."]
position = Vector2(-14, -3.000001)
scale = Vector2(0.51, 0.5766667)
texture = ExtResource("2_v6luj")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
light_mask = 1023
position = Vector2(-14, 5)
shape = SubResource("CapsuleShape2D_ay01c")
